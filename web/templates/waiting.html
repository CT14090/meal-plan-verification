{% extends "base.html" %} 
{% block title %}Ready to Scan - Meal Plan Verification{% endblock %} 
{% block content %}
<div class="container">
  <div class="card">
    <div class="header">
      <h1>üçΩÔ∏è Meal Plan Verification</h1>
      <div class="station">{{ station_name }}</div>
    </div>

    <div class="icon" id="status-icon">üí≥</div>

    <div class="message" id="status-message">
      <strong>READY</strong><br />
      Please scan your student ID card
    </div>

    <div
      class="status-badge status-success"
      id="status-badge"
      style="display: none"
    >
      Waiting for card...
    </div>

    <div style="margin-top: 30px">
      <a href="/manual" class="btn btn-secondary"> Manual Entry </a>
    </div>
  </div>
</div>
{% endblock %} 

{% block scripts %}
<script>
  const statusIcon = document.getElementById("status-icon");
  const statusMessage = document.getElementById("status-message");

  // Animate the card icon
  function animateWaiting() {
    statusIcon.style.transform = "scale(1.1)";
    setTimeout(() => {
      statusIcon.style.transform = "scale(1.0)";
    }, 500);
  }

  setInterval(animateWaiting, 2000);

  // Poll for recent card scans
  let lastCheck = Date.now();
  
  async function checkForCardScan() {
    try {
      // Check MUNDOWARE lookup table for recent scans
      const response = await fetch('/api/check-recent-scan');
      const data = await response.json();
      
      if (data.success && data.student_id) {
        // Card was scanned! Navigate to student info
        window.location.href = `/student-info?student=${data.student_id}`;
      }
    } catch (error) {
      console.error('Error checking for scans:', error);
    }
  }
  
  // Check every 500ms for card scans
  setInterval(checkForCardScan, 500);
</script>
{% endblock %}
